<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Pork Badge</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  </head>
  <body>
    <div id="app">
      <h1>{{ appTitle }} - total {{ vendors.length }} vendors</h1>
      <h3>Current time: {{ currentTime }}</h3>

      <list-of-vendors :traders="vendors"></list-of-vendors>
    </div>

    <script>
      let vendorComponent = {
        props: ["store"],
        data: function () {
          return {
            retailer: this.store,
          };
        },
        computed: {
          vendorColor: function () {
            let badge = "gray";
            let letter = this.retailer.badge_code.charAt(0);
            switch (letter) {
              case "A":
                badge = "green";
                break;
              case "B":
                badge = "red";
                break;
              case "C":
                badge = "orange";
                break;
              case "D":
                badge = "navy";
                break;
            }
            return badge;
          },
        },
        template: `
            <div>
                <a style="color: teal">廠商(</a>
                <a href="" :style="{color: vendorColor}">{{ store.market_name }}, {{ retailer.badge_code }}</a>
                <a style="color: teal">)</a>
            </div>    
        `,
      };

      let listOfVendorsComponent = {
        components: {
          vendor: vendorComponent,
        },
        props: ["traders"],
        template: `
            <ul>
                <h3> Size of all the vendors: {{ traders.length }}</h3>
                <li v-for="(vendor, index) in traders" :key="index">
                    <vendor :store='vendor'></vendor>
                </li>
            </ul>
        `,
      };

      const app = new Vue({
        el: "#app",
        components: {
          listOfVendors: listOfVendorsComponent,
        },
        data: function () {
          return {
            appTitle: "Pork Tagging",
            currentTime: new Date(),
            vendors: [],
          };
        },
        methods: {
          updateTime: function () {
            this.currentTime = new Date();
            window.setTimeout(() => {
              this.updateTime();
            }, 2000);
          },
          refreshData: function (data) {
            this.vendors = data;
          },
        },
      });

      app.updateTime();

      (async () => {
        let response = await fetch("http://127.0.0.1:8080/vendors.json");
        let vendors = await response.json();
        app.refreshData(vendors);
        console.log("done");
      })();
    </script>
  </body>
</html>
